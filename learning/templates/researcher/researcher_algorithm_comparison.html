{% extends 'researcher/researcher-base.html' %}
{% load static %}

{% block title %}算法对比 - 在线学习诊断系统{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{% endblock %}

{% block content %}
<style>
    .algorithm-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        border-left: 4px solid #007bff;
    }

    .algorithm-card.active {
        border-left-color: #28a745;
        background: #f0f8f5;
    }

    .algorithm-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .algorithm-desc {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 15px;
    }

    .comparison-table {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        margin-bottom: 30px;
    }

    .comparison-table table {
        margin-bottom: 0;
    }

    .comparison-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .comparison-table th {
        padding: 15px;
        font-weight: 600;
    }

    .comparison-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #e9ecef;
    }

    .metric-value {
        font-weight: 600;
        color: #007bff;
    }

    .metric-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .metric-badge.best {
        background: #d4edda;
        color: #155724;
    }

    .metric-badge.good {
        background: #cfe2ff;
        color: #084298;
    }

    .metric-badge.normal {
        background: #fff3cd;
        color: #664d03;
    }

    .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 30px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    .filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">
        <i class="fas fa-code-branch me-2"></i>算法对比
    </h1>
</div>

<!-- 筛选区域 -->
<div class="filter-section">
    <div class="row">
        <div class="col-md-4">
            <label class="form-label">选择科目</label>
            <select class="form-select" id="subjectFilter">
                <option value="">全部科目</option>
                {% for subject in subjects %}
                <option value="{{ subject.id }}">{{ subject.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">选择算法</label>
            <select class="form-select" id="algorithmFilter" multiple>
                <option value="irt" selected>IRT (项目反应理论)</option>
                <option value="ncd" selected>NCD (神经认知诊断)</option>
                <option value="simple" selected>Simple (简单诊断)</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-primary w-100" onclick="compareAlgorithms()">
                <i class="fas fa-sync me-2"></i>对比
            </button>
        </div>
    </div>
</div>

<!-- 算法介绍 -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="algorithm-card active">
            <div class="algorithm-title">
                <i class="fas fa-chart-line me-2"></i>IRT 理论
            </div>
            <div class="algorithm-desc">
                项目反应理论，基于学生能力和题目难度的统计模型
            </div>
            <small class="text-muted">
                <i class="fas fa-check me-1"></i>精度高<br>
                <i class="fas fa-check me-1"></i>理论完善<br>
                <i class="fas fa-times me-1"></i>计算复杂
            </small>
        </div>
    </div>

    <div class="col-md-4">
        <div class="algorithm-card">
            <div class="algorithm-title">
                <i class="fas fa-brain me-2"></i>NCD 模型
            </div>
            <div class="algorithm-desc">
                神经认知诊断，基于深度学习的诊断方法
            </div>
            <small class="text-muted">
                <i class="fas fa-check me-1"></i>自适应强<br>
                <i class="fas fa-check me-1"></i>效果好<br>
                <i class="fas fa-times me-1"></i>需要数据多
            </small>
        </div>
    </div>

    <div class="col-md-4">
        <div class="algorithm-card">
            <div class="algorithm-title">
                <i class="fas fa-calculator me-2"></i>简单诊断
            </div>
            <div class="algorithm-desc">
                基于正确率的简单诊断方法
            </div>
            <small class="text-muted">
                <i class="fas fa-check me-1"></i>快速简单<br>
                <i class="fas fa-check me-1"></i>易理解<br>
                <i class="fas fa-times me-1"></i>精度低
            </small>
        </div>
    </div>
</div>

<!-- 对比图表 -->
<div class="row">
    <div class="col-lg-6">
        <div class="chart-container">
            <canvas id="accuracyChart"></canvas>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="chart-container">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>
</div>

<!-- 对比表格 -->
<div class="comparison-table">
    <table class="table">
        <thead>
            <tr>
                <th>指标</th>
                <th>IRT 理论</th>
                <th>NCD 模型</th>
                <th>简单诊断</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>诊断精度</strong></td>
                <td>
                    <span class="metric-badge best">92.5%</span>
                </td>
                <td>
                    <span class="metric-badge best">94.2%</span>
                </td>
                <td>
                    <span class="metric-badge normal">78.3%</span>
                </td>
            </tr>
            <tr>
                <td><strong>计算时间</strong></td>
                <td>
                    <span class="metric-badge good">2.3s</span>
                </td>
                <td>
                    <span class="metric-badge normal">5.1s</span>
                </td>
                <td>
                    <span class="metric-badge best">0.2s</span>
                </td>
            </tr>
            <tr>
                <td><strong>知识点覆盖</strong></td>
                <td>
                    <span class="metric-badge best">98%</span>
                </td>
                <td>
                    <span class="metric-badge best">99%</span>
                </td>
                <td>
                    <span class="metric-badge normal">85%</span>
                </td>
            </tr>
            <tr>
                <td><strong>学生满意度</strong></td>
                <td>
                    <span class="metric-badge good">4.2/5</span>
                </td>
                <td>
                    <span class="metric-badge best">4.6/5</span>
                </td>
                <td>
                    <span class="metric-badge normal">3.5/5</span>
                </td>
            </tr>
            <tr>
                <td><strong>推荐指数</strong></td>
                <td>
                    <span class="metric-badge good">★★★★☆</span>
                </td>
                <td>
                    <span class="metric-badge best">★★★★★</span>
                </td>
                <td>
                    <span class="metric-badge normal">★★★☆☆</span>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 精度对比图
    const accuracyCtx = document.getElementById('accuracyChart').getContext('2d');
    new Chart(accuracyCtx, {
        type: 'radar',
        data: {
            labels: ['诊断精度', '计算速度', '知识覆盖', '用户体验', '可扩展性'],
            datasets: [
                {
                    label: 'IRT 理论',
                    data: [92.5, 75, 98, 84, 88],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)'
                },
                {
                    label: 'NCD 模型',
                    data: [94.2, 60, 99, 92, 90],
                    borderColor: '#764ba2',
                    backgroundColor: 'rgba(118, 75, 162, 0.1)'
                },
                {
                    label: '简单诊断',
                    data: [78.3, 95, 85, 70, 75],
                    borderColor: '#f093fb',
                    backgroundColor: 'rgba(240, 147, 251, 0.1)'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '算法性能对比'
                }
            },
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });

    // 性能对比图
    const performanceCtx = document.getElementById('performanceChart').getContext('2d');
    new Chart(performanceCtx, {
        type: 'bar',
        data: {
            labels: ['IRT 理论', 'NCD 模型', '简单诊断'],
            datasets: [
                {
                    label: '诊断精度 (%)',
                    data: [92.5, 94.2, 78.3],
                    backgroundColor: '#667eea'
                },
                {
                    label: '计算速度 (相对)',
                    data: [75, 60, 95],
                    backgroundColor: '#764ba2'
                },
                {
                    label: '用户满意度',
                    data: [84, 92, 70],
                    backgroundColor: '#f093fb'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '多维度性能评估'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
});

function compareAlgorithms() {
    const subject = document.getElementById('subjectFilter').value;
    const algorithms = Array.from(document.getElementById('algorithmFilter').selectedOptions).map(o => o.value);
    console.log('Comparing algorithms:', algorithms, 'for subject:', subject);
    // 实现对比逻辑
}
</script>

{% endblock %}
